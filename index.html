<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=0.5" />
<title>もなちゃとWebクライアント</title>
<link rel="canonical" href="http://monachat.tk" />
<select>
  <option value="entrance">入り口</option>
  <option value="main">メイン</option>
  <option value="area">地域別</option>
  <option value="theme">話題別</option>
  <option value="crisscross">縦横部屋</option>
  <option value="wide">ワイド</option>
  <option value="large">大部屋</option>
  <option value="pulloff1">待避所</option>
  <option value="pulloff2">待避所2</option>
  <option value="lab">小実験室</option>
  <option value="monachat.dyndns.org/monachatfb.html">FB待避所</option>
  <option value="chat.moja.jp/animal.html">ちびちゃと</option>
  <option value="cool.moja.jp">クールなびじゅつかん</option>
  <option value="cool.moja.jp/kanpu.html">クールなかんぷまさつ</option>
</select>
<div>
  <embed
    src="http://monachat.dyndns.org/mojachat5l.swf"
    width="740"
    height="360"
    bgcolor="#ffffff"
    allowscriptaccess="always"
    flashvars="maxuser=0&amp;title=http://monachat.dyndns.org/monatitle.swf&amp;charPath=http://monachat.dyndns.org/char/&amp;characters=モナー系:mona,marumimi,shodai,oomimi,kuromimi,polygon,agemona,anamona,mora,urara,fuun,iiajan,nida,gerara,sens,gari,yamazaki1,yamazaki2,boljoa3,boljoa4,puru,mosamosa1,mosamosa2,mosamosa3,mosamosa4,kamemona,ﾜｼｮｰｲ系:oni,wachoi,oniini,tofu,niku,ω系:iyou,ppa2,foppa,charhan,aramaki,>>1 8頭身:ichi,ichi2,ichineko,hat2,hati4,hati,hati3,女の子系:remona,monaka,riru,alice,batu,mina,miwa,kabin,ギコしぃ系:giko,tatigiko,zuza,sugoi3,ging,maturi,usi,nezumi,abogado,bana,uma,sika,kato,haka,tokei,gyouza,papi,tibigiko,fusa,suwarifusa,tibifusa,sii2,tibisii,tuu,hokkyoku6,顔文字系:jien,kita,haa,nyog,gaku,shob,shak,boljoa,その他1:mouk,mouk1,mouk2,hikk,dokuo,dokuo2,hosh,sira,siranaiwa,tiraneyo,ginu,unko,kasiwa,kappappa,zonu,asou,hiyoko,nin3,kunoichi,osa,cock,coc2,ri_man,chichon,nanyo,tahara,maji,kikko2,sumaso2,niraneko,niraime,niraime2,niramusume,その他2:chotto1,chotto2,chotto3,mossari,yokan,koit,koya,ranta,kyaku,taxi,moudamepo,sai,shaitama,welneco2,kagami,gakuri,unknown2,裏キャラ:boljoa2,joruju,joruju2,nazoko,nin,tibifusa2,unknown&amp;stagePath=http://monachat.dyndns.org/stage/&amp;stages=st1,st2,st3,st4,st5,st6,st7,st8,st9,st10,st11,st12,st13,st14,saitama,bargiko,wasyoido,jinja,yamanasi,sasuga,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,st1room,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,&amp;stagenames=もなちゃと,祭,貞子,樹海,廃墟,ハァ？,キラキラ,サッ,食い逃げ,学校,喫茶,Flash,東京精神病院,ヲタ,さいたま,BARギコ,ワショーイ堂,神社,やまなし,流石兄弟,もなちゃと21,もなちゃと22,もなちゃと23,もなちゃと24,もなちゃと25,もなちゃと26,もなちゃと27,もなちゃと28,もなちゃと29,もなちゃと30,もなちゃと31,もなちゃと32,もなちゃと33,もなちゃと34,もなちゃと35,もなちゃと36,もなちゃと37,もなちゃと38,もなちゃと39,もなちゃと40,もなちゃと41,もなちゃと42,もなちゃと43,もなちゃと44,もなちゃと45,もなちゃと46,もなちゃと47,もなちゃと48,もなちゃと49,もなちゃと50,もなちゃと51,もなちゃと52,もなちゃと53,もなちゃと54,もなちゃと55,もなちゃと56,もなちゃと57,もなちゃと58,もなちゃと59,もなちゃと60,もなちゃと61,もなちゃと62,もなちゃと63,もなちゃと64,もなちゃと65,もなちゃと66,もなちゃと67,もなちゃと68,もなちゃと69,もなちゃと70,もなちゃと71,もなちゃと72,もなちゃと73,もなちゃと74,もなちゃと75,もなちゃと76,もなちゃと77,もなちゃと78,もなちゃと79,もなちゃと80,もなちゃと81,もなちゃと82,もなちゃと83,もなちゃと84,もなちゃと85,もなちゃと86,もなちゃと87,もなちゃと88,もなちゃと89,もなちゃと90,もなちゃと91,もなちゃと92,もなちゃと93,もなちゃと94,もなちゃと95,もなちゃと96,もなちゃと97,もなちゃと98,もなちゃと99,もなちゃと100&amp;colors=100,90,70,40&amp;stats=通常,退席中,取り込み中,ﾏﾀｰﾘ,殺伐,祭り,ﾜｼｮｰｲ,ﾏﾝｾｰ,ﾊｧﾊｧ,ﾊﾗﾍﾀｰ,ﾊﾗｲﾊﾟｰｲ,ｳﾏｰ,ﾏｽﾞｰ,ｱﾂｰ,ｻﾑｰ,ﾈﾑｰ,ﾓｳﾀﾞﾒﾎﾟ&amp;igNameFormat=$n◆$t (ID:$id)&amp;description=<b>もなちゃとのきまり</b><br>・荒らし煽りには「無視機能」(荒らし退治も荒らしと同類ですよ)<br>・いきなり歳や性別などを聞くのはやめよう<br>・個人情報は自分で守ろう<br>・頻繁に部屋を出入りするのはやめよう<br>・青少年の健全な育成に害のある会話は禁止です（チャットHやネットナンパも禁止ですよ）<br>・犯罪行為につながる会話は禁止です<br>・ﾏﾀｰﾘ<br>いろいろな世代・地域の人が集まる場所です。<br>マナーを守り、みんなで楽しく過ごせるようにしましょう。<br>&amp;numchkTime=60&amp;pingTime=20&amp;ig=IP&amp;RTD=on&amp;RTDI=6&amp;srvPort=8094&amp;servicePort=9095&amp;igVisible=OFF&amp;logmode=balloon&amp;tripLength=10&amp;swidth=740&amp;sheight=360&amp;end=true&amp;playTimeout=0&amp;stageTimeout=0&amp;autotrip=on&amp;regularStatOnly=OFF&amp;vmove=ON&amp;view=3D&amp;app=MONA"
  />
</div>
<script>
  if (!Object.fromEntries) {
    Object.fromEntries = (iterable) =>
      [...iterable].reduce(
        (object, [key, value]) => ({ ...object, ...{ [key]: value } }),
        {},
      );
  }

  const param = (object) =>
    Object.entries(object)
      .map(([key, value]) => `${key}=${value}`)
      .join('&');

  const deparam = (string) =>
    Object.fromEntries(string.split('&').map((pair) => pair.split('=')));

  const MONACHAT_HOSTNAME = 'monachat.dyndns.org';
  const CHIBICHAT_HOSTNAME = 'chat.moja.jp';
  const THE_COOL_MUSEUM_HOSTNAME = 'cool.moja.jp';

  const CHIBICHAT_WIDTH = 720;
  const CHIBICHAT_BGCOLOR = '#ece4d7';

  const THE_COOL_MUSEUM_CLIENT = 'mojachat5h.swf';

  const $select = document.querySelector('select');
  const $div = document.querySelector('div');
  const $embed = document.querySelector('embed');

  const DEFAULT_CLIENT = new URL($embed.src).pathname.replace(/^\//, '');
  const DEFAULT_WIDTH = $embed.width;
  const DEFAULT_HEIGHT = $embed.height;
  const DEFAULT_BGCOLOR = $embed.getAttribute('bgcolor');

  fetch('chatconf.json')
    .then((response) => response.json())
    .then((flashvarsTable) => {
      $select.addEventListener('change', () => {
        const url = $select.value;

        const hostname = url.includes('.')
          ? new URL('http://' + url).hostname
          : MONACHAT_HOSTNAME;

        const isMonachat = hostname === MONACHAT_HOSTNAME;
        const isChibichat = hostname === CHIBICHAT_HOSTNAME;
        const isTheCoolMuseum = hostname === THE_COOL_MUSEUM_HOSTNAME;

        const flashvars = deparam(flashvarsTable[url]);

        Object.assign(flashvars, {
          maxuser: 0,
          playTimeout: 0,
          stageTimeout: 0,
          autotrip: 'on',
          regularStatOnly: 'OFF',
          ...(flashvars.vmove !== 'ON'
            ? {
                vmove: 'ON',
                view: '3D',
                ...(!flashvars.app ? { app: 'MONA' } : {}),
              }
            : {}),
        });

        ['title', 'charPath', 'stagePath'].forEach((key) => {
          if (!flashvars[key]) return;

          flashvars[key] = `http://${hostname}/${flashvars[key]}`;
        });

        if (isMonachat) {
          flashvars.characters += `,裏キャラ:${[
            'boljoa2',
            'joruju',
            'joruju2',
            'nazoko',
            'nin',
            'tibifusa2',
            'unknown',
          ].join(',')}`;
        }

        flashvars.stages += ','.repeat(
          1000 - flashvars.stages.split(',').length,
        );

        if (new URL($embed.src).hostname !== hostname) {
          $embed.src = `http://${hostname}/${
            isTheCoolMuseum ? THE_COOL_MUSEUM_CLIENT : DEFAULT_CLIENT
          }`;
        }

        $embed.width = document.body.style.width =
          flashvars.swidth || (isChibichat && CHIBICHAT_WIDTH) || DEFAULT_WIDTH;

        $embed.height = document.body.style.height =
          flashvars.sheight || DEFAULT_HEIGHT;

        const bgcolor = isChibichat ? CHIBICHAT_BGCOLOR : DEFAULT_BGCOLOR;

        if ($embed.getAttribute('bgcolor') !== bgcolor) {
          $embed.setAttribute('bgcolor', bgcolor);
          document.body.style.backgroundColor = bgcolor;
        }

        $embed.setAttribute('flashvars', param(flashvars));

        $div.innerHTML = $embed.outerHTML;

        history.replaceState(null, null, `#${encodeURIComponent(url)}`);
      });

      window.addEventListener('hashchange', () => {
        let url = location.hash.replace(/^#/, '');

        if (!url) return;

        url = decodeURIComponent(url);

        if ($select.value === url) return;

        $select.value = url;
        $select.dispatchEvent(new Event('change'));
      });

      window.dispatchEvent(new HashChangeEvent('hashchange'));
    });
</script>
<style>
  body {
    height: 360px;
    margin: 0 auto;
    width: 740px;
  }

  select {
    display: flex;
    margin-left: auto;
  }
</style>
